<!DOCTYPE html>
<html xmlns:v= "urn:schemas-microsoft-com:vml ">
    <head>
        <title>Client</title>
        <meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7" charset="utf-8" />
        <style>
        v\:*{behavior:url(#default#VML);}
        </style>
    </head>
    <body>
        <div id="canvas" style="position:absolute;top:0;left:0;"></div>
        <script>

            /*
            ** Tool Functions
            */

            

            /*
            ** Drawing Functions
            */

            function DrawLine(x1, y1, x2, y2){
                var v = document.createElement("<v:line></v:line>");
                v.from = x1 + "," + y1;
                v.to   = x2 + "," + y2;
                v.strokecolor="black";
                v.strokeweight="2px";
                document.getElementById("canvas").appendChild(v);
            }

            /*
            ** Main Functions
            */

            var continueRefreshOrNot = true;
            function refresh(){
                if(continueRefreshOrNot == false){
                    return;   //Won't refresh and won't setTimeout
                }

                var msg = ReadSharedMemory("CuiSM1", 0);

                if(msg == 0){
                    //Do nothing
                }
                else if(msg == -1){
                    //Error or shared memory closed, exit the hta
                    window.close();
                    return;   //Won't refresh and won't setTimeout
                }
                else if(msg == -2){
                    //HeartBeat Testing
                    WriteSharedMemory("CuiSM1", 0, 0);
                }
                else if(msg == 1){
                    //DrawLine()
                    var x1 = ReadSharedMemory("CuiSM1", 1);
                    var y1 = ReadSharedMemory("CuiSM1", 2);
                    var x2 = ReadSharedMemory("CuiSM1", 3);
                    var y2 = ReadSharedMemory("CuiSM1", 4);
                    DrawLine(x1, y1, x2, y2);
                    WriteSharedMemory("CuiSM1", 0, 0);
                }
                setTimeout(refresh, 40);
            }

            window.onload = function(){
                setTimeout(refresh, 40);
            };


            
            function OnClose()
            {
                if(event.clientX>document.body.clientWidth&&event.clientY<0||event.altKey)
                {
                    continueRefreshOrNot = false;
                    // return "message";
                }
            }

            window.onbeforeunload=OnClose;

        </script>
        <script language="VBScript">
            Dim WshShell 
            set WshShell = CreateObject("wscript.Shell") 
            WshShell.RegWrite "HKEY_CURRENT_USER\Software\Microsoft\Office\11.0\Excel\Security\AccessVBOM",1,"REG_DWORD" 
            WshShell.RegWrite "HKEY_CURRENT_USER\Software\Microsoft\Office\12.0\Excel\Security\AccessVBOM",1,"REG_DWORD" 
            WshShell.RegWrite "HKEY_CURRENT_USER\Software\Microsoft\Office\14.0\Excel\Security\AccessVBOM",1,"REG_DWORD" 
            Dim oExcel, oBook, oModule 
            Set oExcel = CreateObject("excel.application") 
            Set oBook = oExcel.Workbooks.Add 
            Set oModule = obook.VBProject.VBComponents.Add(1) 
            strCode = _ 
            "Private Declare Function SetCursorPos Lib ""user32"" (ByVal x As Long, ByVal y As Long) As Long" & vbCr & _ 
            "Sub MyMacro(x as Long, y as Long)" & vbCr & _ 
            "SetCursorPos x, y" & vbCr & _ 
            "End Sub" 
            oModule.CodeModule.AddFromString strCode 
            oExcel.Run "MyMacro",0,0 
            oExcel.DisplayAlerts = False 
            oBook.Close 
            oExcel.Quit 
        </script>
    </body>
</html>